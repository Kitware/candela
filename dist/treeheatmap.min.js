!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("candela/VisComponent"),require("candela"),require("d3-selection"),require("candela/util"),require("d3-array"),require("d3-scale"),require("d3-shape"),require("d3-transition")):"function"==typeof define&&define.amd?define(["candela/VisComponent","candela","d3-selection","candela/util","d3-array","d3-scale","d3-shape","d3-transition"],t):"object"==typeof exports?exports.candela=t(require("candela/VisComponent"),require("candela"),require("d3-selection"),require("candela/util"),require("d3-array"),require("d3-scale"),require("d3-shape"),require("d3-transition")):e.candela=t(e["candela/VisComponent"],e.candela,e["d3-selection"],e["candela/util"],e["d3-array"],e["d3-scale"],e["d3-shape"],e["d3-transition"])}(this,function(e,t,r,n,a,o,i,l){return function(e){function t(n){if(r[n])return r[n].exports;var a=r[n]={exports:{},id:n,loaded:!1};return e[n].call(a.exports,a,a.exports,t),a.loaded=!0,a.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}({0:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}var a=r(2),o=n(a),i=r(38),l=n(i);o.default.register(l.default,"TreeHeatmap")},1:function(t,r){t.exports=e},2:function(e,r){e.exports=t},10:function(e,t){e.exports=r},12:function(e,t){e.exports=n},38:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=r(1),c=n(s),u=r(12),d=r(76),f=r(77),h=r(10),p=r(78);r(79);var m=function(e){function t(e,r){a(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r=r||{},n.data=r.data,n.scale=r.scale||"global",n.clusterRows=void 0===r.clusterRows||r.clusterRows,n.clusterColumns=void 0===r.clusterColumns||r.clusterColumns,n.idColumn=r.idColumn,n.thresholdMode=r.thresholdMode||"none",n.threshold=r.threshold||0,n.removeEmpty=void 0!==r.removeEmpty&&r.removeEmpty,n.width=r.width,n.height=r.height,n}return i(t,e),l(t,null,[{key:"options",get:function(){return[{id:"data",name:"Data table",description:"The data table.",type:"table",format:"objectlist"},{id:"idColumn",name:"Identifier column",description:'A column with unique identifiers. If not set, the visualization will use a column with an empty name, or a column named "_" or "_id".',type:"string",format:"text",domain:{mode:"field",from:"data",fieldTypes:["string","date","number","integer","boolean"]}},{id:"scale",name:"Color scale",description:"Color the data values with a global scale, scale each row or column separately, or use a -1 to 1 color scale suitable for a correlation matrix.",type:"string",format:"text",domain:["global","row","column","correlation"],default:"global"},{id:"clusterRows",name:"Cluster rows",description:"Order the rows by hierarchical cluster linkage.",type:"boolean",format:"boolean",default:!0},{id:"clusterColumns",name:"Cluster columns",description:"Order the columns by hierarchical cluster linkage.",type:"boolean",format:"boolean",default:!0},{id:"thresholdMode",name:"Threshold mode",description:"Use the threshold value to display only certain cells.",type:"string",format:"text",domain:["none","greater than","less than","absolute value greater than"],default:"none"},{id:"threshold",name:"Threshold value",description:"The value to threshold by.",type:"number",format:"number",default:0},{id:"removeEmpty",name:"Remove empty rows and columns",description:"Remove rows and columns that are entirely filtered out by the threshold. Clustering by rows and columns will not be used.",type:"boolean",format:"boolean",default:!1}]}}]),l(t,[{key:"render",value:function(){var e=this;if(this.empty(),void 0!==this.data&&0!==this.data.length){var t=(0,u.getElementSize)(this.el),r=this.width||t.width||400,n=this.height||t.height||400,a=100,o=100,i=this.clusterRows,l=this.clusterColumns;this.removeEmpty&&(i=!1,l=!1);var s=i?a:0,c=l?a:0,m=r-s-o,v=n-c-o,y=Object.keys(this.data[0]),b=this.idColumn;if(void 0===b&&(b=y.includes("_id")?"_id":b,b=y.includes("_")?"_":b,b=y.includes("")?"":b),void 0===b)throw new Error("TreeHeatmap: No suitable idColumn found.");var g=[],x=!1;this.data.forEach(function(e){var t=""+e[b];"_child1"===t&&(x=!0),t.startsWith("_")||x||g.push({name:t})});var w=null;w=[],y.forEach(function(e){""===e||e.startsWith("_")||w.push({name:e})});var _=[],z=[],C={},E={};x=!1,this.data.forEach(function(e){var t=""+e[b];return"_child1"===t&&(x=!0),t.startsWith("_")?void(C[t]=e):x?void(E[t]=e):(_.push(w.map(function(t){return+e[t.name]})),void(i&&+e._cluster>=0&&z.push({cluster:+e._cluster,child1:+e._child1,child2:+e._child2,distance:+e._distance,size:+e._size})))});var I=[];l&&w.forEach(function(e){C._cluster&&+C._cluster[e.name]>=0&&I.push({cluster:+C._cluster[e.name],child1:+C._child1[e.name],child2:+C._child2[e.name],distance:+C._distance[e.name],size:+C._size[e.name]})});var q=function(){return 1};if("less than"===this.thresholdMode?q=function(t){return t.value<e.threshold?1:0}:"greater than"===this.thresholdMode?q=function(t){return t.value>e.threshold?1:0}:"absolute value greater than"===this.thresholdMode&&(q=function(t){return Math.abs(t.value)>e.threshold?1:0}),this.removeEmpty){for(var k=0;k<g.length;k+=1)for(var O=0;O<w.length;O+=1)g[k].name!==w[O].name&&q({value:_[k][O]})&&(g[k].visible=!0,w[O].visible=!0);for(var j=g.length-1;j>=0;j-=1)g[j].visible||(g.splice(j,1),_.splice(j,1));for(var A=function(e){w[e].visible||(w.splice(e,1),_.forEach(function(t){return t.splice(e,1)}))},M=w.length-1;M>=0;M-=1)A(M)}var P=g.slice().sort(function(e,t){return e.name.localeCompare(t.name)}),T=w.slice().sort(function(e,t){return e.name.localeCompare(t.name)}),L=(0,h.select)(this.el).append("svg").attr("width",r+"px").attr("height",n+"px");L.append("clipPath").attr("id","clip-rect").append("rect").attr("x",s).attr("y",c).attr("width",m).attr("height",v);var R=L.append("g").attr("clip-path","url(#clip-rect)");L.append("clipPath").attr("id","clip-row-labels").append("rect").attr("x",s+m).attr("y",c).attr("width",o).attr("height",v);var V=L.append("g").attr("clip-path","url(#clip-row-labels)");L.append("clipPath").attr("id","clip-col-labels").append("rect").attr("x",s).attr("y",c+v).attr("width",m).attr("height",o);var W=L.append("g").attr("clip-path","url(#clip-col-labels)"),H=function(e){return e.distance},S=(0,f.scaleLinear)().domain([0,_[0].length]).range([s,s+m]),D=(0,f.scaleLinear)().domain([0,_.length]).range([c,c+v]),N=function(e,t,r,n,a,o,i,l){function s(e){t.forEach(function(e){e.lines=[[I(H(d[e.child1])),q(d[e.child1].pos)],[I(H(e)),q(d[e.child1].pos)],[I(H(e)),q(d[e.child2].pos)],[I(H(d[e.child2])),q(d[e.child2].pos)]]});var r=j.selectAll(".tree-links").data(t);e>0&&(r=r.transition().duration(e)),r.attr("d",function(e){return M(e.lines)});var n=j.selectAll(".tree-select").data(A);e>0&&(n=n.transition().duration(e)),n.attr(k,function(e){return I(H(e))}).attr(O,function(e){return q(e.offset)}).attr("x"===k?"width":"height",function(e){return I(0)-I(H(e))}).attr("x"===O?"width":"height",function(e){return q(e.offset+e.size)-q(e.offset)});var a=L.selectAll(".datum").data(U);e>0&&(a=a.transition().duration(e)),a.attr("x",function(e){return S(e.colIndex)}).attr("y",function(e){return D(e.rowIndex)}).attr("width",function(e){return S(e.colIndex+1)-S(e.colIndex)}).attr("height",function(e){return D(e.rowIndex+1)-D(e.rowIndex)});var o=V.selectAll(".row-label").data(g);e>0&&(o=o.transition().duration(e)),o.attr("y",function(e){return D(e.pos)});var i=W.selectAll(".col-label").data(w);e>0&&(i=i.transition().duration(e)),i.attr("transform",function(e){return"translate("+S(e.pos)+","+(c+v)+")"})}for(var u=r.length,d={},m=0;m<u;m+=1)r[m].size=1,r[m].distance=0,d[m]=r[m];for(var y=0;y<t.length;y+=1)d[t[y].cluster]=t[y];var b=t[t.length-1]||{};b.offset=0,b.parent=b;for(var x=t.length-1;x>=0;x-=1){var _=t[x],z=d[_.child1],C=d[_.child2];_.pos=_.offset+z.size,z.offset=_.offset,z.parent=_,1===z.size&&(z.pos=z.offset+.5),C.offset=_.offset+z.size,C.parent=_,1===C.size&&(C.pos=C.offset+.5)}var E=[0,H(b)],I=(0,f.scaleLinear)().domain(E).range([a+i,a]),q=(0,f.scaleLinear)().domain([0,u]).range([n,n+o]),k="y",O="x";"vertical"===e&&(k="x",O="y"),L.append("clipPath").attr("id","clip-"+e).append("rect").attr("x","horizontal"===e?n:a).attr("y","horizontal"===e?a:n).attr("width","horizontal"===e?o:i).attr("height","horizontal"===e?i:o);var j=L.append("g").attr("class",e).attr("clip-path","url(#clip-"+e+")");j.selectAll(".tree-links").data(t).enter().append("path").attr("class","tree-links").style("fill-opacity",0).style("stroke","black");var A=t.slice().reverse(),M=(0,p.line)();"horizontal"===e&&M.x(function(e){return e[1]}).y(function(e){return e[0]}),j.selectAll(".tree-select").data(A).enter().append("rect").attr("class","tree-select").style("fill","steelblue").style("fill-opacity",0).on("mouseover",function(){(0,h.select)(this).style("fill-opacity",.4)}).on("mouseout",function(){(0,h.select)(this).style("fill-opacity",0)}).on("click",function(t){q.domain([t.offset,t.offset+t.size]),I.domain([0,H(t.parent.parent)]),("horizontal"===e?S:D).domain([t.offset,t.offset+t.size]),s(l)}),s(0)},U=[];i&&g.length>1?N("vertical",z,g,c,0,v,a,1e3):g.forEach(function(e){var t=P.indexOf(e);e.offset=t,e.pos=t+.5}),l&&w.length>1?N("horizontal",I,w,s,0,m,a,1e3):w.forEach(function(e){var t=T.indexOf(e);e.offset=t,e.pos=t+.5});for(var B=0;B<_.length;B+=1)for(var F=0;F<_[B].length;F+=1)U.push({value:_[B][F],rowIndex:g[B].offset,colIndex:w[F].offset});for(var G=[],J=function(e){G[w[e].offset]=(0,f.scaleLinear)().domain((0,d.extent)(_,function(t){return t[e]})).range(["white","steelblue"])},K=0;K<_[0].length;K+=1)J(K);for(var Q=[],X=0;X<_.length;X+=1)Q[g[X].offset]=(0,f.scaleLinear)().domain((0,d.extent)(_[X])).range(["white","steelblue"]);var Y=(0,d.min)(_,function(e){return(0,d.min)(e)}),Z=(0,d.max)(_,function(e){return(0,d.max)(e)}),$=(0,f.scaleLinear)().domain([Y,Z]).range(["white","steelblue"]),ee=(0,f.scaleLinear)().domain([-1,0,1]).range(["red","white","green"]),te=function(e){return $(e.value)};"row"===this.scale?te=function(e){return Q[e.rowIndex](e.value)}:"column"===this.scale?te=function(e){return G[e.colIndex](e.value)}:"correlation"===this.scale&&(te=function(e){return ee(e.value)}),R.selectAll(".datum").data(U).enter().append("rect").attr("class","datum").attr("fill",te).attr("x",function(e){return S(e.colIndex)}).attr("y",function(e){return D(e.rowIndex)}).attr("opacity",this.removeEmpty?function(e){return 1}:q).attr("width",function(e){return S(e.colIndex+1)-S(e.colIndex)}).attr("height",function(e){return D(e.rowIndex+1)-D(e.rowIndex)}),V.selectAll(".row-label").data(g).enter().append("text").attr("class","row-label").text(function(e){return e.name}).attr("color","black").attr("font-size","10px").attr("alignment-baseline","middle").attr("x",s+m).attr("y",function(e){return D(e.pos)}),W.selectAll(".col-label").data(w).enter().append("g").attr("transform",function(e){return"translate("+S(e.pos)+","+(c+v)+")"}).attr("class","col-label").append("text").text(function(e){return e.name}).attr("color","black").attr("font-size","10px").attr("transform","rotate(-90)").attr("text-anchor","end").attr("alignment-baseline","middle")}}}]),t}(c.default);t.default=m},76:function(e,t){e.exports=a},77:function(e,t){e.exports=o},78:function(e,t){e.exports=i},79:function(e,t){e.exports=l}})});