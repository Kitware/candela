[
  "@defaults",
  [
    ["width", 800],
    ["height", 500],
    ["padding", 30],
    ["tickSize", 6],
    ["time", "time"],
    ["censor", "censor"]
  ],
  {
    "width": ["@get", "width"],
    "height": ["@get", "height"],
    "padding": ["@get", "padding"],
    "data": [
      {
        "name": "table",
        "values": ["@get", "data"],
        "transform": [
          {
            "type": "sort",
            "by": [["@get", "time"]]
          }
        ]
      },
      {
        "name": "censored",
        "source": "table",
        "transform": [
          {
            "type": "sort",
            "by": [["@get", "time"]]
          },
          {
            "type": "filter",
            "test": ["@join", "", ["datum['", ["@get", "censor"], "'] == 0"]]
          }
        ]
      }
    ],
    "scales": [
      {
        "name": "xscale",
        "range": "width",
        "domain": {
          "data": "table",
          "field": ["@get", "time"]
        }
      },
      {
        "name": "yscale",
        "range": "height",
        "domain": {
          "data": "table",
          "field": "survivors"
        }
      }
    ],
    "axes": [
      {
        "type": "x",
        "scale": "xscale"
      },
      {
        "type": "y",
        "scale": "yscale"
      }
    ],
    "marks": [
      {
        "type": "line",
        "from": {
          "data": "table"
        },
        "properties": {
          "enter": {
            "interpolate": {"value": "step-after"},
            "x": {
              "scale": "xscale",
              "field": ["@get", "time"]
            },
            "y": {
              "scale": "yscale",
              "field": "survivors"
            },

            "stroke": {"value": "black"},
            "strokeWidth": {"value": 1}
          }
        }
      },
      {
        "type": "rect",
        "from": {
          "data": "censored"
        },
        "properties": {
          "enter": {
            "x": {
              "scale": "xscale",
              "field": ["@get", "time"],
              "offset": -0.5
            },
            "x2": {
              "scale": "xscale",
              "field": ["@get", "time"],
              "offset": 0.5
            },
            "y": {
              "scale": "yscale",
              "field": "survivors",
              "offset": ["@mult", ["@get", "tickSize"], -0.5]
            },
            "y2": {
              "scale": "yscale",
              "field": "survivors",
              "offset": ["@mult", ["@get", "tickSize"], 0.5]
            },
            "fill": {"value": "black"}
          }
        }
      }
    ]
  }
]
